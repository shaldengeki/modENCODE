<h3>Search for attempts</h3>
<%= form_for(@attempt, :url => {:action=>"search"}, :html => {:class => 'form-horizontal'}) do |f| %>
  <fieldset>
    <%= render :partial => "transcription_factors/search_name", :locals => {:f => f, :model_type => "attempt"} %>
    <%= render :partial => "reagents/show_isoform_checkboxes", :locals => {:f => f, :transcription_factor => nil, :isoforms => @attempt.reagent.nil? ? nil : @attempt.reagent.isoforms, :model_type => "attempt"} %>
    <div id="attempt-attributes-list" class="control-group">
      <%= label_tag "attempt_values", "Attributes", :class => "control-label" %>
      <div class="controls">
        <% AttemptAttribute.all.each do |attempt_attribute| %>
          <div class="control-group">
            <%= label "attempt[attempt_values_attributes][][name]", attempt_attribute.name, :class=>"control-label" %>
            <div class="controls">
              <%= hidden_field_tag "attempt[attempt_values_attributes][][attempt_attribute_id]", attempt_attribute.id  %>
              <%= text_field_tag "attempt[attempt_values_attributes][][value]", ""  %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
    <div id="attempt-current-status" class="control-group">
      <%= label_tag "attempt[status]", "Current status", :class => "control-label" %>
      <div class="controls">
        <%= f.fields_for :status do |builder| %>
          <%= builder.grouped_collection_select :step_id, Pipeline.all, :steps, :name, :id, :name, {:default => nil, :include_blank => true} %>
        <% end %>
      </div>
    </div>
    <div class="form-actions">
      <%= f.submit "Search", :id => "search_attempt", :class => "btn btn-primary" %>
    </div>
  </fieldset>
<% end %>
<table id='attempt-search' class="table table-bordered table-striped">
  <thead>
  <tr>
    <th>Pipeline</th>
    <th>Reagent</th>
    <th>Isoform(s)</th>
    <th>User(s)</th>
    <th>Last status</th>
    <th>Started</th>
    <th>Last updated</th>
  </tr>
  </thead>
  <tbody>
  <% @attempts.each do |attempt| %>
    <tr>
      <td><%= link_to attempt.pipeline.name, attempt %></td>
      <td><%= link_to attempt.reagent.name, attempt.reagent %></td>
      <td><%= attempt.reagent.isoforms.empty? || attempt.reagent.isoforms.blank? ? "None" : raw((attempt.reagent.isoforms.map{|isoform| link_to(isoform.name, isoform)}).join(",")) %></td>
      <td><%= attempt.users.empty? || attempt.users.blank? ? "None" : raw((attempt.users.map{|user| link_to(user.name, user)}).join(",")) %></td>
      <td><%= attempt.last_status.nil? ? "None" : link_to(attempt.last_status.step.name.to_s + " (" + attempt.last_status.outcome_text + ")", attempt.last_status) %></td>
      <td><%= attempt.started_at.nil? ? "Never" : link_to(I18n.localize(attempt.started_at, :format => :short), attempt.first_status) %></td>
      <td><%= attempt.last_status.nil? ? "Never" : link_to(I18n.localize(attempt.last_status.updated_at, :format => :short), attempt.last_status) %></td>
    </tr>
  <% end %>
  </tbody>
</table>